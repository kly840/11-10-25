<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="robots" content="noindex"/>
  <title>Mini Quiz</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/styles.css"/>

  <style>
    /* logo top-left (gi·ªëng index) */
    .logo-top{ position:absolute; top:18px; left:18px; display:inline-block; }
    .logo-top img{
      height:48px; width:auto; opacity:.95;
      transition:transform .12s ease, filter .12s ease;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.08));
    }
    .logo-top:hover img{ transform:scale(1.06); filter: drop-shadow(0 6px 14px rgba(0,0,0,.16)); }

    /* page layout: ƒë·ªÉ bottom nav xu·ªëng cu·ªëi khi n·ªôi dung √≠t */
    .page{ display:flex; flex-direction:column; min-height:75dvh; }

    /* l∆∞·ªõi 2 c·ªôt */
    .quiz-wrap{ display:grid; grid-template-columns:1fr 1fr; gap:28px; margin-top:40px; }
    @media (max-width:900px){ .quiz-wrap{ grid-template-columns:1fr; } }

    /* c·ªôt tr√°i: khung c√¢u h·ªèi */
    .quiz-box{ background:var(--soft); padding:20px 28px; border-radius:12px; box-shadow:var(--shadow); }
    .quiz-box label{ display:block; font-weight:700; margin:12px 0 6px; }
    .quiz-box input{ width:100%; padding:10px 14px; border-radius:12px; border:1px solid rgba(89,2,2,.25); }

    /* d√≤ng ‚ÄúOnly opens after the quiz‚Äù ‚Äî ƒë·∫≠m + to g·∫•p ƒë√¥i */
    .callout{ font-weight:800; font-size:clamp(18px,3.2vw,26px); margin:12px 0; }

    /* n√∫t tr·∫Øng cho ‚Äúunlock my letter ^^‚Äù */
    .btn-white{
      background:#fff; color:var(--accent); border:2px solid var(--accent);
      padding:10px 18px; border-radius:25px; font-weight:700; cursor:pointer;
      transition:background .2s,color .2s; box-shadow:var(--shadow);
    }
    .btn-white:hover{ background:var(--accent); color:#fff; }

    /* bottom nav (ƒë·ªè, cƒÉn gi·ªØa, s√°t cu·ªëi trang) */
    .spacer{ flex:1 1 auto; }
    .bottom-nav{ display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-top:12px; margin-bottom:4px; }

    /* ·∫£nh b√™n ph·∫£i: gi·ªØ size g·ªëc theo khung v√πng */
    .right-img{ display:flex; justify-content:center; align-items:center; }
    .right-img img{ max-width:100%; height:auto; border-radius:16px; box-shadow:var(--shadow); }
  </style>
</head>
<body>
  <!-- 1) Logo -->
  <a href="./index.html" class="logo-top" aria-label="Home"><img src="./assets/heart_logo.png" alt="logo"></a>

  <header>
    <h1>Heyyyy! Before you read my letter...</h1>
    <p>you gotta answer a mini-quiz to unlock it üí°</p>
    <!-- 3) callout to & bold -->
    <p class="callout">Only opens after the quiz</p>
  </header>

  <main class="page">
    <section class="quiz-wrap">
      <!-- 4) Column 1: ch·ªâ gi·ªØ n√∫t Unlock (tr·∫Øng) trong khung -->
      <div class="quiz-box">
        <form id="quiz-form">
          <label>1) Our first call ended at what time?</label>
          <input type="text" name="q1" placeholder="e.g., 02:13 AM" required>

          <label>2) Where did we see the broken umbrella?</label>
          <input type="text" name="q2" placeholder="place" required>

          <label>3) The safe-word on our first trip?</label>
          <input type="text" name="q3" placeholder="word" required>

          <button type="submit" class="btn-white" style="margin-top:16px;">unlock my letter ^^</button>
          <p id="msg" class="small" style="margin-top:6px;"></p>
        </form>
      </div>

      <!-- 5) Column 2: ch·ªâ ·∫£nh, c√≥ link t·ªõi letter-1 (gi·ªØ nguy√™n size hi·ªÉn th·ªã) -->
      <div class="right-img">
        <a href="https://kly840.github.io/11-10-25/letters/letter-1.html" target="_blank" rel="noopener">
          <img src="./assets/hello_nhan_khungf_letter.png" alt="Hello Nhan khungf">
        </a>
      </div>
    </section>

    <div class="spacer"></div>

    <!-- 4) Bottom nav: Back Home ‚Äì My Letter ‚Äì Audio (ƒë·ªè, cƒÉn gi·ªØa, s√°t footer) -->
    <nav class="bottom-nav">
      <a class="btn" href="./index.html">Back Home</a>
      <a class="btn" href="./timeline.html">Memory</a>
      <a class="btn" href="./audio.html">Audio</a>
    </nav>
  </main>

  <!-- 2) Footer -->
  <footer class="small" style="text-align:center">from kly ‚ô°</footer>

  <!-- JS: ki·ªÉm tra ƒë√°p √°n ‚Üí t·∫°o token ‚Üí m·ªü th∆∞ -->
  <script>
    // ==== CONFIG (gi·ªØ ƒë√∫ng v·ªõi letter page) ====
    const ANSWERS = {
      q1: ["2:13 am","02:13 am","0213"],
      q2: ["bus stop","at the bus stop"],
      q3: ["pineapple"]
    };
    const SALT = "kly840";
    const LETTER_URL = "./letters/letter-1.html";

    // Helpers
    function normalize(s){
      return (s||"").toString().trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,"");
    }
    async function sha256Hex(str){
      const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    function isAllCorrect(fd){
      return Object.keys(ANSWERS).every(k=>{
        const a = normalize(fd.get(k));
        return (ANSWERS[k]||[]).some(ok=>normalize(ok)===a);
      });
    }
    async function buildCanonicalToken(){
      const joined = Object.keys(ANSWERS).map(k=>normalize(ANSWERS[k][0])).join("|") + "|" + SALT;
      return sha256Hex(joined);
    }

    // (optional) nh·ªè: confetti vui vui
    function confetti(){ for(let i=0;i<70;i++){ const s=document.createElement('span'); s.className='confetti';
      s.style.left=Math.random()*100+'vw'; s.style.background=`hsl(${Math.random()*360}deg 90% 60%)`;
      s.style.animationDuration=(1.1+Math.random()*0.9)+'s'; s.style.width=(6+Math.random()*6)+'px'; s.style.height=(10+Math.random()*10)+'px';
      document.body.appendChild(s); setTimeout(()=>s.remove(), 1800);
    }}

    const form = document.getElementById('quiz-form');
    const msg  = document.getElementById('msg');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data = new FormData(form);

      if(!isAllCorrect(data)){
        msg.textContent = "Nahhh, try again! You don't love me that muchüôÑ";
        return;
      }
      msg.textContent = "Gh√™ z·∫° ƒë√∫ng r√πi! Unlocking letter‚Ä¶ üíñ";
      confetti();

      const token = await buildCanonicalToken();
      const url = new URL(LETTER_URL, location.href);
      url.searchParams.set("t", token);
      setTimeout(()=>{ location.href = url.toString(); }, 800);
    });
  </script>
</body>
</html>
