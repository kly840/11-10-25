<script>
  document.addEventListener('DOMContentLoaded', () => {
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSQN4PFm-uNK4cj4ZDjz8K5xxXE6SYGw-sr5lZ0kaAJGHFhd4jcfjuJ_-wBnF96FhbvTThDQz7iZBU/pub?gid=453699801&single=true&output=csv"; // ends with output=csv
    const listEl = document.getElementById('list');

    fetch(CSV_URL)
      .then(r => r.text())
      .then(text => {
        const parsed = Papa.parse(text, { header: true });
        let rows = parsed.data.filter(r => r["Title"] && r["Title"].trim());

        // Sort by Google Form "Timestamp" (newest first)
        rows.sort((a, b) => {
          const ta = new Date(a["Timestamp"] || 0);
          const tb = new Date(b["Timestamp"] || 0);
          return tb - ta;
        });

        listEl.innerHTML = rows.map(r => {
          const when = (r["When"] || "").trim();
          const title = (r["Title"] || "").trim();
          const why = (r["Why is this memorable to u?"] || "").trim();
          const photo = (r["Photo URL"] || "").trim();
          return `
            <article class="card">
              ${when ? `<div class="small">When: ${when}</div>` : ``}
              <h3>${title}</h3>
              ${photo ? `<img alt="" src="${photo}">` : ``}
              ${why ? `<p>${why}</p>` : ``}
            </article>
          `;
        }).join("");

        if (!rows.length) listEl.innerHTML = `<p>No memories yet â€” add one <a href="./add.html">here</a> ðŸ’Œ</p>`;
      })
      .catch(err => {
        console.error(err);
        listEl.innerHTML = `<p>Could not load memories ðŸ˜¢</p>`;
      });
  });
</script>
