<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex" />
  <title>Our Timeline â€” 11Â·10Â·25</title>

  <!-- Minimal styles (self-contained) -->
  <style>
    :root { --bg:#0e0f13; --fg:#f6f7fb; --muted:#aab1c6; --card:#171922; --acc:#77b7ff; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:radial-gradient(60% 60% at 50% 35%,#1b1e29, #0e0f13);
      color:var(--fg); font:16px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    a{color:var(--acc); text-decoration:none}
    header{max-width:960px; margin:24px auto 0; padding:0 16px}
    h1{margin:0 0 6px; font-size:32px}
    .small{color:var(--muted); font-size:13px}
    main{max-width:960px; margin:16px auto 40px; padding:0 16px}
    .grid{display:grid; gap:16px}
    .mem{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:var(--card); border-radius:16px; padding:16px}
    img{max-width:100%; border-radius:12px; display:block}
    nav.mini{margin-top:16px; display:flex; gap:16px; flex-wrap:wrap}
    .empty,.error{background:#201f2a; border:1px dashed #3b3a46; border-radius:14px; padding:14px}
    footer{max-width:960px; margin:0 auto 32px; padding:0 16px}
  </style>

  <!-- PapaParse to read CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Your published CSV (keep as-is; you can replace later if needed)
      const CSV_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSQN4PFm-uNK4cj4ZDjz8K5xxXE6SYGw-sr5lZ0kaAJGHFhd4jcfjuJ_-wBnF96FhbvTThDQz7iZBU/pub?gid=453699801&single=true&output=csv";

      const listEl = document.getElementById('list');
      const statusEl = document.getElementById('status');

      fetch(CSV_URL, { cache: "no-store" })
        .then(r => {
          if (!r.ok) throw new Error("CSV not reachable");
          return r.text();
        })
        .then(text => {
          const parsed = Papa.parse(text, { header: true });
          let rows = (parsed.data || []).filter(r => r && r["Title"] && r["Title"].trim());

          // Sort by Google Form Timestamp (newest first) if present
          rows.sort((a, b) => new Date(b["Timestamp"] || 0) - new Date(a["Timestamp"] || 0));

          if (!rows.length) {
            statusEl.innerHTML = `<div class="empty">No memories yet â€” add one <a href="./add.html">here</a> ðŸ’Œ</div>`;
            return;
          }

          listEl.innerHTML = rows.map(r => {
            const when  = (r["When"] || "").toString().trim();
            const title = (r["Title"] || "").toString().trim();
            const why   = (r["Why is this memorable to u?"] || "").toString().trim();
            const photo = (r["Photo URL"] || "").toString().trim();

            // basic sanitization for images (optional)
            const safeImg = photo && /^https?:\/\//i.test(photo) ? photo : "";

            return `
              <article class="card">
                ${when ? `<div class="small">When: ${when}</div>` : ``}
                <h3 style="margin:6px 0 10px">${title}</h3>
                ${safeImg ? `<img alt="" src="${safeImg}">` : ``}
                ${why ? `<p style="margin:10px 0 0">${why}</p>` : ``}
              </article>
            `;
          }).join("");
        })
        .catch(err => {
          console.error(err);
          statusEl.innerHTML = `<div class="error">Could not load memories ðŸ˜¢ â€” check CSV publish link & headers.</div>`;
        });
    });
  </script>
</head>
<body>
  <header>
    <h1>Our memories</h1>
    <p class="small">Add yours via the form â†’ <a href="./add.html">here</a>.</p>
  </header>

  <main>
    <div id="status"></div>
    <section id="list" class="grid mem" aria-live="polite"></section>

    <nav class="mini">
      <a href="./quiz.html">Take the mini-quiz â†’ unlock letters</a>
      <a href="./index.html">Back home</a>
    </nav>
  </main>

  <footer class="small">
    <span>11Â·10Â·25 â€” made with love.</span>
  </footer>
</body>
</html>
