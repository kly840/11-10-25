<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="robots" content="noindex"/>
  <title>Our Memory</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin:0; padding:0;
      background:#fffafc;
      color:#222;
    }

    /* logo top-left */
    .logo-top{ position:absolute; top:18px; left:18px; display:inline-block; }
    .logo-top img{
      height:48px; width:auto; opacity:.95;
      transition:transform .12s ease, filter .12s ease;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.08));
    }
    .logo-top:hover img{ transform:scale(1.06); filter: drop-shadow(0 6px 14px rgba(0,0,0,.16)); }

    header{ text-align:center; padding-top:72px; }
    header h1{ font-size:clamp(22px,4vw,32px); margin-bottom:8px; }

    .callout{
      font-weight:800;
      font-size:clamp(20px, 3.4vw, 28px);
      margin:8px 0 14px;
    }

    .page{ display:flex; flex-direction:column; min-height:75dvh; }

    /* Gallery grid */
    .gallery{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
      gap:22px;
      padding:20px;
      justify-items:center;
    }

    .polaroid{
      background:#fff;
      padding:10px;
      border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.1);
      max-width:280px;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
    }

    /* media container: force 1:1 */
    .media-box{
      position:relative;
      width:100%;
      padding-top:100%; /* 1:1 aspect */
      overflow:hidden;
      border-radius:8px;
      margin-bottom:10px;
      background:#f8f8f8;
    }
    .media-box img,
    .media-box iframe{
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      object-fit:cover;
      border:0;
    }

    .caption .title{ font-weight:700; margin-bottom:4px; }
    .caption .when{ font-size:0.8rem; color:#666; margin-bottom:6px; }
    .caption p{ font-size:0.85rem; margin:0; line-height:1.3; }

    /* smaller why text */
    .caption p{ font-size:0.78rem; }

    .spacer{ flex:1 1 auto; }

    .bottom-nav{
      display:flex; gap:12px; justify-content:center;
      margin:16px 0 6px;
    }
    .btn{
      background:#e63946; color:white; text-decoration:none;
      padding:10px 20px; border-radius:25px;
      font-weight:600; transition:background .2s;
    }
    .btn:hover{ background:#c62839; }

    footer{ text-align:center; font-size:0.85rem; margin-bottom:10px; color:#555; }
  </style>
</head>
<body>
  <!-- Logo -->
  <a href="./index.html" class="logo-top" aria-label="Home">
    <img src="./assets/heart_logo.png" alt="logo">
  </a>

  <header>
    <h1>our memories together &gt;&lt;</h1>
    <p class="callout">
      You can add yours via this form â†’ 
      <a href="PASTE_YOUR_GOOGLE_FORM_LINK" target="_blank" rel="noopener">Here</a>
    </p>
  </header>

  <main class="page">
    <div id="status"></div>
    <section id="list" class="gallery" aria-live="polite"></section>
    <div class="spacer"></div>

    <nav class="bottom-nav">
      <a class="btn" href="./index.html">Back Home</a>
      <a class="btn" href="./quiz.html">My letter</a>
      <a class="btn" href="./audio.html">Audio</a>
    </nav>
  </main>

  <footer>from kly â™¡</footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSQN4PFm-uNK4cj4ZDjz8K5xxXE6SYGw-sr5lZ0kaAJGHFhd4jcfjuJ_-wBnF96FhbvTThDQz7iZBU/pub?gid=453699801&single=true&output=csv";
      const listEl  = document.getElementById('list');
      const statusEl= document.getElementById('status');

      function renderMedia(url,type){
        const clean = (url||"").trim();
        if(type==="Video"){
          // Ensure preview link
          let idMatch = clean.match(/\/d\/([^/]+)/);
          let id = idMatch? idMatch[1]:"";
          let src = id? `https://drive.google.com/file/d/${id}/preview` : clean;
          return `<div class="media-box"><iframe src="${src}" allow="autoplay; encrypted-media" allowfullscreen loading="lazy"></iframe></div>`;
        }else{
          return `<div class="media-box"><img loading="lazy" src="${clean}" alt=""></div>`;
        }
      }

      function cardHTML(r){
        const when  = (r["When"] || "").trim();
        const title = (r["Title"] || "").trim();
        const why   = (r["Why is this memorable to u?"] || "").trim();
        const url   = (r["Photo URL"] || "").trim();
        const type  = (r["Type"] || "Photo").trim();
        const media = url? renderMedia(url,type):"";
        return `
          <article class="polaroid">
            ${media}
            <div class="caption">
              <div class="title">${title || "(untitled)"}</div>
              ${when? `<div class="when">${when}</div>`:""}
              ${why? `<p>${why}</p>`:""}
            </div>
          </article>
        `;
      }

      fetch(CSV_URL,{cache:"no-store"})
        .then(r=>r.text())
        .then(text=>{
          const parsed = Papa.parse(text,{header:true});
          let rows = (parsed.data||[]).filter(r=>r && r["Title"] && r["Title"].trim());
          rows.sort((a,b)=> new Date(b["Timestamp"]||0) - new Date(a["Timestamp"]||0));
          if(!rows.length){ statusEl.innerHTML = `<div class="empty">No memories yet ðŸ’Œ</div>`; return; }
          listEl.innerHTML = rows.map(cardHTML).join("");
        })
        .catch(err=>{ console.error(err); statusEl.innerHTML = `<div class="error">Could not load memories ðŸ˜¢</div>`; });
    });
  </script>
</body>
</html>