<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="robots" content="noindex"/>
  <title>My Letter for You</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/styles.css"/>

  <style>
    /* logo top-left (y nh∆∞ index) */
    .logo-top{ position:absolute; top:18px; left:18px; display:inline-block; }
    .logo-top img{
      height:48px; width:auto; opacity:.95;
      transition:transform .12s ease, filter .12s ease;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.08));
    }
    .logo-top:hover img{ transform:scale(1.06); filter: drop-shadow(0 6px 14px rgba(0,0,0,.16)); }

    /* b·ªë c·ª•c ƒë·ªÉ bottom nav lu√¥n s√°t cu·ªëi khi n·ªôi dung √≠t */
    .page{ display:flex; flex-direction:column; min-height:75dvh; }
    .spacer{ flex:1 1 auto; }

    /* kh·ªëi gi·ªØa: 3 c·ªôt (stickers tr√°i ‚Äì letter ‚Äì stickers ph·∫£i) */
    .wrap{
      display:grid; grid-template-columns:100px 1fr 100px; gap:16px; align-items:start;
      margin-top:10px;
    }
    @media (max-width:900px){
      .wrap{ grid-template-columns:1fr; }
      .stickers{ display:flex; gap:10px; justify-content:center; }
    }

    .stickers{ position:relative; }
    .stickers img{ display:block; margin:10px auto; }

    /* th·∫ª th∆∞ tr·∫Øng ·ªü gi·ªØa */
    .letter{ background:var(--paper); color:var(--text); border-radius:18px; padding:22px; box-shadow:var(--shadow); }

    /* bottom nav (ƒë·ªè, cƒÉn gi·ªØa, ngay tr√™n footer) */
    .bottom-nav{
      display:flex; gap:12px; flex-wrap:wrap; justify-content:center;
      margin-top:12px; margin-bottom:4px;
    }

    /* d√≤ng ph·ª• tr√™n ƒë·∫ßu */
    .sub{ margin-top:4px; margin-bottom:6px; color:var(--muted) }
  </style>
</head>
<body>
  <!-- 1) Logo -->
  <a href="../index.html" class="logo-top" aria-label="Home"><img src="../assets/heart_logo.png" alt="logo"></a>

  <header>
    <h1>Your Letter ‚úâÔ∏è</h1>
    <p class="small sub">Only opens after the quiz</p>
  </header>

  <main class="page">
    <!-- Kh√≥a n·∫øu ch∆∞a c√≥ token -->
    <div id="locked" class="empty" style="max-width:760px; margin:0 auto">
      Locked üîí ‚Äî Please solve the <a href="../quiz.html">mini-quiz</a> first.
    </div>

    <!-- 3 c·ªôt: stickers tr√°i | letter | stickers ph·∫£i -->
    <section id="gate" style="display:none">
      <div class="wrap">
        <!-- 3) Stickers b√™n tr√°i (ngo√†i khung th∆∞) -->
        <aside class="stickers" aria-hidden="true">
          <img src="../assets/hello_nhan_khungf_stamp.png" alt="" class="img-48">
          <img src="../assets/mini_heart.png" alt="" class="img-22">
        </aside>

        <!-- Th∆∞ tr·∫Øng ·ªü gi·ªØa -->
        <article class="letter" id="content">
          <p class="small" style="margin:0 0 10px">November 11, 2025</p>
          <h2>my letter for u</h2>
          <p>Hello Nhan khungf,</p>
          <p>Dear Naan,</p>
          <p>abc xyz ‚Ä¶ (vi·∫øt n·ªôi dung th∆∞ ·ªü ƒë√¢y)</p>
          <p>Yours,<br/>Kylie</p>
        </article>

        <!-- 3) Stickers b√™n ph·∫£i (ngo√†i khung th∆∞) -->
        <aside class="stickers" aria-hidden="true">
          <img src="../assets/red_heart.png" alt="" class="img-32">
          <img src="../assets/mini_heart_rev.png" alt="" class="img-22">
        </aside>
      </div>
    </section>

    <div class="spacer"></div>

    <!-- 4) 3 n√∫t ƒë·ªè, cƒÉn gi·ªØa, ngay tr√™n footer -->
    <nav class="bottom-nav">
      <a class="btn" href="../index.html">Back Home</a>
      <a class="btn" href="../timeline.html">Memory</a>
      <a class="btn" href="../audio.html">Audio</a>
    </nav>
  </main>

  <!-- 2) Footer -->
  <footer class="small" style="text-align:center">from kly ‚ô°</footer>

  <!-- Gate logic: so kh·ªõp token -->
  <script>
    const ANSWERS = { q1:["2:13 am","02:13 am","0213"], q2:["bus stop","at the bus stop"], q3:["pineapple"] };
    const SALT = "kly840";

    function normalize(s){ return (s||"").toString().trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""); }
    async function sha256Hex(str){
      const buf=await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    async function expectedToken(){
      const joined=Object.keys(ANSWERS).map(k=>normalize(ANSWERS[k][0])).join("|")+"|"+SALT;
      return sha256Hex(joined);
    }

    (async()=>{
      const t=new URLSearchParams(location.search).get("t")||"";
      const ok = t && t === await expectedToken();
      document.getElementById('locked').style.display = ok ? "none":"block";
      document.getElementById('gate').style.display   = ok ? "block":"none";
    })();
  </script>
</body>
</html>
